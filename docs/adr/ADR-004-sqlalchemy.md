# ADR-004: Использование SQLAlchemy ORM и защита от SQL-инъекций

**Дата:** 2025-10-22
**Статус:** Accepted

## Context
Приложение работает с реляционной базой данных и подвержено риску SQL-инъекций. Прямое использование SQL-запросов создает security-риски и сложности поддержки.

## Decision
Использовать SQLAlchemy ORM с практиками безопасности:
- Только ORM и Query API для операций с БД
- Запрет на сырые SQL-строки в бизнес-логике
- Параметризованные запросы при использовании `text()`
- Валидация входных данных перед передачей в ORM

## Alternatives
1. **Сырые SQL-запросы** - высокий риск инъекций
2. **Другие ORM** - не соответствуют стеку
3. **Ручное экранирование** - error-prone подход

## Consequences
### Плюсы
- Автоматическая защита от SQL-инъекций
- Типобезопасность кода
- Улучшенная поддерживаемость

### Минусы
- Overhead на маппинг ORM

## Security Impact
- Устранение SQL-инъекций как класса уязвимостей
- Автоматическое экранирование пользовательских данных

## Rollout Plan
1. Написание SQL-запросов на SQLAlchemy ORM

## Links
- NFR-04 (Защита от SQL-инъекций)
- R2 из Threat Model (SQL Injection)
