# ADR-002: Инъекция зависимостей через единую точку входа
Дата: 2025-01-15
Статус: Accepted

## Context
Глобальные состояния и разрозненное создание зависимостей усложняют тестирование, приводят к race conditions и нарушают принцип единственной ответственности.

## Decision
Внедрена явная инъекция зависимостей через:
- Явную передачу зависимостей в конструкторы в cmd
- Отказ от глобальных переменных и синглтонов

## Alternatives
1. **Глобальные переменные** - простой старт, но непредсказуемое состояние. Типичный пример для питона.
2. **Service Locator** - скрытые зависимости, сложность отладки
3. **Фреймворки DI** (dependency-injector) - избыточная сложность

## Consequences
### Плюсы
- Прозрачность зависимостей
- Упрощение мокирования в тестах
- Контроль жизненного цикла объектов
- Предотвращение race conditions

### Минусы
- Необходимость явно передавать зависимости
- Initial overhead настройки контейнера

## Security Impact
- Исключение глобального состояния предотвращает data leaks между запросами
- Явные зависимости упрощают security-аудит
- Контроль инициализации security-критичных компонентов

## Rollout Plan
1. Писать весь код сразу с инъекцией зависимостей

## Links
- отдельный NFR под "качественный код" не заведен
- Реализация: `app/cmd/`
